# CRD - Concept & Requirements Document
## AI Auto Podcast システム構想・要件定義書

---

## 1. プロジェクト概要

| 項目 | 内容 |
|------|------|
| **プロジェクト名** | AI Auto Podcast |
| **目的** | 最新ニュースを自動収集し、AI音声でポッドキャストを生成・配信する |
| **コンセプト** | 低コスト × 完全自動化 × 高品質AI音声 × 低メンテナンス |

---

## 2. 機能要件（Functional Requirements）

### FR-01: コンテンツ収集
- 複数のニュースソースから最新記事を自動取得する
- 国内ソース（日本語）と海外ソース（英語）の両方に対応する
- ソースの追加・変更が容易にできる
- トピックキーワードによるフィルタリングができる

### FR-02: ポッドキャストスクリプト生成（速報版）
- 収集した記事をもとに、ポッドキャスト台本（対話形式）をAIで自動生成する
- 全記事を簡潔に紹介するダイジェスト形式（5〜8分、1500〜2500文字）
- プロンプトによるトーン・スタイルの制御ができる
- 日本語対応

### FR-02-D: ポッドキャストスクリプト生成（深掘り版）
- 収集した全記事の中からAIが重要度の高い2〜3件を自動選定する
- 選定した記事について6つの分析次元（背景・経緯、技術解説、業界影響、異なる視点、日本と海外の比較、今後の展望）で深掘りする
- 10〜15分の対話形式（3000〜5000文字）、1トピックあたり5〜8往復の議論
- 速報版と同じ PRONUNCIATION_MAP（発音辞書）を共有する

### FR-03: 音声生成（TTS）
- スクリプトから音声ファイルを自動生成する
- 自然で聞きやすい音声品質を実現する
- 複数話者による対話形式（Multi-Speaker TTS 1コール）をサポートする
- 14人の話者が曜日ごとにローテーション（7ペア）し、速報版と深掘り版で同じペアを使用する

### FR-04: 配信
- リスナーがポッドキャストアプリ（Apple Podcasts, Spotify等）で購読できる
- 速報版と深掘り版をそれぞれ独立したRSSフィード（`feed.xml` / `feed_deep.xml`）で配信する
- 新エピソードが自動的に配信される
- 各番組で独立したカバーアート・タイトル・説明文を持つ

### FR-05: 自動化
- 定期的に自動実行される（毎日 06:00 JST）
- 1回の実行で速報版・深掘り版の両方を生成する
- 手動実行にも対応する

---

## 3. 非機能要件（Non-Functional Requirements）

### NFR-01: コスト
- 月額運用コストを可能な限り低く抑える（理想は無料〜$10/月）

### NFR-02: 信頼性
- 公式APIベースで安定動作する（UIスクレイピング禁止）
- 実行環境でエラーなく確実に動作する

### NFR-03: セキュリティ
- APIキー等の認証情報をコードに平文保存しない

### NFR-04: 保守性
- コードベースをシンプルに保つ
- 外部サービスのUI変更で壊れない設計にする

### NFR-05: 拡張性
- コンテンツソース、TTS、配信先を将来切り替え可能にする

---

## 4. 手法の全面検討

本プロジェクトは以下の4つのレイヤーに分解できる。各レイヤーで独立に手法を選択可能。

```
[コンテンツ収集] → [スクリプト生成] → [音声生成] → [配信]
```

---

### 4.1 コンテンツ収集

| 手法 | コスト | 実装難度 | 柔軟性 | 説明 |
|------|--------|---------|--------|------|
| **A. RSS/Atomフィード解析** | 無料 | ◎ 簡単 | ◯ | feedparserでパブリックRSSを解析。現行方式 |
| **B. ニュースAPI** | △ 有料 | ◎ 簡単 | ◎ | NewsAPI, GNews API等。構造化データ取得が容易 |
| **C. Webスクレイピング** | 無料 | △ 中程度 | △ | BeautifulSoup/Scrapy。サイト変更で破損リスク |
| **D. LLM Web検索** | △ 有料 | ◎ 簡単 | ◎ | OpenAI Web Search / Perplexity API。要約込みで取得可能 |

**推奨: A（RSSフィード）**
- 無料、安定、十分な情報量。現行実装をそのまま流用可能
- 国内6ソース（テクノロジー）+ 海外3ソース（TechCrunch, Ars Technica, Hacker News）+ 国内4ソース（経済）= 計13ソース

**検討に値する拡張: D（LLM Web検索）**
- 「今日のAIニュースをまとめて」と指示するだけで、収集・要約・構造化が一括で完了
- コンテンツ収集＋スクリプト生成を1ステップに統合できる可能性

---

### 4.2 スクリプト生成（LLM）

| 手法 | コスト/回 | 品質 | 日本語 | 説明 |
|------|----------|------|--------|------|
| **A. OpenAI GPT-4o-mini** | ~$0.01 | ◎ | ◎ | 高品質・低コスト。対話台本生成に最適 |
| **B. Google Gemini 2.5 Flash** | 無料枠あり | ◎ | ◎ | 無料枠が非常に大きい（15 RPM, 100万トークン/日） |
| **C. Claude 3.5 Haiku** | ~$0.01 | ◎ | ◎ | 日本語の自然さに定評 |
| **D. ローカルLLM（Ollama等）** | 無料 | △〜◯ | △ | GPUが必要。品質はモデル依存 |
| **E. スクリプト不要（直接TTS）** | - | - | - | 記事テキストをそのままTTSに渡す。対話形式不可 |

**推奨: A or B**
- **コスト最小化**: B（Gemini Flash）— 無料枠で月数百回のスクリプト生成が可能
- **品質重視**: A（GPT-4o-mini）— 対話台本の自然さが優れている
- 両者ともAPIキー1つで動作し、実装は数十行

---

### 4.3 音声生成（TTS）

| 手法 | コスト/15分EP | 品質 | 対話形式 | 日本語 | 説明 |
|------|-------------|------|---------|--------|------|
| **A. Gemini 2.5 Flash TTS** | **無料** | ◎ | ◎ プロンプト指示 | ◯ | `gemini-2.5-flash-preview-tts` 無料枠あり。LLMベースで感情・対話制御 |
| **B. VOICEVOX** | **無料** | ◎ | ◎ 話者別呼び出し | ◎◎ | OSS日本語特化TTS。30+キャラ。REST API。Docker対応 |
| **C. OpenAI gpt-4o-mini-tts** | ~$0.23 | ◎ | ◯ 話者別呼び出し | ◯ | instructions で感情・トーン制御。13音声。MP3直出力 |
| **D. Google Cloud TTS WaveNet** | **無料** | ◯ | △ SSML手動 | ◎ | 月400万文字無料。日本語WaveNet音声あり |
| **E. ElevenLabs** | $5-22/月 | ◎◎ | ◯ Projects | ◎ | 業界最高品質。無料枠は月~10分のみ |
| **F. Edge-TTS（Microsoft）** | **無料** | ◯ | △ | ◎ | 非公式だがオープンソース。完全無料・日本語良好 |
| **G. 現行: Notebook LM Selenium** | 無料 | ◎ | ◎ 自動2話者 | ◎ | **不安定**。公式API無し。CI不可。1日3回制限 |

**推奨: A（Gemini Flash TTS）** — 無料・高品質・対話形式対応・プロンプトで制御可能 ⭐
**日本語最高品質: B（VOICEVOX）** — 完全無料。日本語に特化したOSS。30+キャラで複数話者の掛け合い可能。ただし実行環境にインストール必要
**有料で確実: C（OpenAI TTS）** — 品質は保証。$7/月程度

---

### 4.4 スケジューリング・実行基盤

| 手法 | コスト | セットアップ | 柔軟性 | 説明 |
|------|--------|------------|--------|------|
| **A. GitHub Actions** | 無料（月2000分） | ◎ 簡単 | ◯ | 現行方式。ただし cron 遅延あり・60日無活動で自動停止 |
| **B. Google Cloud Functions / Run** | ほぼ無料 | ◯ | ◎ | Cloud Scheduler + 関数実行。月200万呼び出し無料 |
| **C. AWS Lambda + EventBridge** | ほぼ無料 | ◯ | ◎ | 月100万リクエスト無料 |
| **D. ローカルcron + スクリプト** | 無料 | ◎ 簡単 | △ | マシンが常時起動必要 |
| **E. Raspberry Pi / 常時起動マシン** | 電気代のみ | △ | ◯ | 自宅サーバー。24時間運用 |
| **F. Render / Railway / Fly.io** | 無料〜$5/月 | ◎ 簡単 | ◯ | 無料枠あり。cron job対応 |
| **G. Zapier / Make** | 無料〜$20/月 | ◎ ノーコード | ◯ | ノーコード。RSS→Webhook→スクリプト実行 |

**推奨: B（Cloud Functions / Run + Cloud Scheduler）** — 完全マネージド、時刻正確、無料枠で十分
**代替: D（ローカルcron）** — 最もシンプル。常時起動PCがあれば最適
**非推奨: A（GitHub Actions）** — cronの遅延（数分〜1時間）、60日無活動で自動停止のリスクあり

---

### 4.5 ホスティング・配信

| 手法 | コスト | 容量 | RSS対応 | 説明 |
|------|--------|------|---------|------|
| **A. GitHub Pages** | 無料 | 1GB / 100GB転送 | 自前生成 | 現行方式。静的ファイル配信 |
| **B. Spotify for Creators** | 無料 | 無制限 | 自動生成 | 旧Anchor。無料で無制限ホスティング。主要アプリ自動配信 |
| **C. Podbean** | 無料〜$12/月 | 5時間(無料) | 自動生成 | AI Podcast Creator機能あり |
| **D. Buzzsprout** | $0〜$19/月 | 2-4時間/月(無料) | 自動生成 | ポッドキャスト特化 |
| **E. Cloudflare R2 + Workers** | ほぼ無料 | 10GB無料 | 自前生成 | エグレス無料。大容量向き |
| **F. S3 + CloudFront** | ~$1/月 | 従量 | 自前生成 | AWS。スケーラブル |
| **G. 自前サーバー (VPS)** | $3-5/月 | 自由 | 自前生成 | 完全制御。Caddy/Nginx |

**推奨: B（Spotify for Creators）** — 完全無料・無制限・主要アプリ自動配信。RSSフィード自前生成不要
**代替: A（GitHub Pages）** — 現行方式。自前RSS生成が必要だが制御しやすい
**大容量: E（Cloudflare R2）** — エピソード数が増えても転送量コスト$0

---

### 4.6 推奨組み合わせ

#### プランα: 完全無料 × 高品質（$0/月） ⭐推奨

| レイヤー | 選択 | コスト |
|---------|------|--------|
| コンテンツ収集 | RSS フィード | $0 |
| スクリプト生成 | Gemini 2.5 Flash（無料枠） | $0 |
| 音声生成 | Gemini 2.5 Flash TTS（無料枠） | $0 |
| スケジューリング | Cloud Functions + Scheduler（無料枠） | $0 |
| 配信 | Spotify for Creators | $0 |
| **合計** | | **$0/月** |

**メリット**: 完全無料で高品質。LLMベースTTSなのでプロンプトで対話形式・感情制御可能。スクリプト生成とTTSが同じGemini APIキーで動作。
**デメリット**: Previewモデルのため仕様変更の可能性あり。日本語品質は要テスト。
**注意**: 無料枠はデータがモデル改善に利用される（有料枠では利用されない）

---

#### プランβ: 日本語特化 × 完全無料（$0/月）

| レイヤー | 選択 | コスト |
|---------|------|--------|
| コンテンツ収集 | RSS フィード | $0 |
| スクリプト生成 | Gemini 2.5 Flash（無料枠） | $0 |
| 音声生成 | VOICEVOX（ローカル or Docker） | $0 |
| スケジューリング | ローカルcron or Cloud Run | $0 |
| 配信 | Spotify for Creators | $0 |
| **合計** | | **$0/月** |

**メリット**: 完全無料。日本語TTS品質が最高レベル。30+キャラで対話形式の掛け合いが可能。OSSなので仕様変更リスクなし。
**デメリット**: VOICEVOXエンジンの実行環境が必要（ローカル or Docker）。Cloud Functionsでの実行にはコンテナ化が必要。

---

#### プランγ: 有料で安定（~$8/月）

| レイヤー | 選択 | コスト |
|---------|------|--------|
| コンテンツ収集 | RSS フィード | $0 |
| スクリプト生成 | GPT-4o-mini or Gemini Flash | ~$0.30 |
| 音声生成 | OpenAI gpt-4o-mini-tts | ~$7 |
| スケジューリング | Cloud Functions + Scheduler | $0 |
| 配信 | Spotify for Creators | $0 |
| **合計** | | **~$7.30/月** |

**メリット**: 安定したSLA。Preview非依存。品質保証。
**デメリット**: 月$7程度のTTSコスト

---

## 5. 現行方式との差分

推奨プランαを採用した場合、現行コードベースから**削除可能**になるもの（既に削除済み）:

| 削除対象 | 行数 | 理由 |
|---------|------|------|
| `oauth_automation.py` | 1,041行 | Selenium不要 |
| `multi_browser_automation.py` | 695行 | ブラウザ不要 |
| `firefox_automation.py` | 830行 | ブラウザ不要 |
| `notebooklm_automation.py` | 239行 | Notebook LM不要 |
| `debug_chrome_minimal.py` | 249行 | Chrome不要 |
| `debug_chrome_verbose.py` | 206行 | Chrome不要 |
| `oauth_setup.py` | 181行 | OAuth不要 |
| `test_notebook_lm.py` | 105行 | Notebook LM不要 |
| `OAUTH_SETUP.md` | 229行 | OAuth不要 |
| `APP_PASSWORD_SETUP.md` | 107行 | アプリパスワード不要 |
| **合計** | **3,882行** | — |

**残すもの**: `content_manager.py`, `rss_feed_generator.py`（配信先次第）, `config.py`
**新規作成**: `script_generator.py`（LLMスクリプト生成 ~100行）, `tts_generator.py`（TTS呼び出し ~100行）, `podcast_generator.py`（オーケストレーター 書き直し ~100行）

コードベースは **3,882行削除 → ~300行の新規コード** で大幅にシンプル化される。

---

## 6. ユーザーストーリー

| ID | ストーリー |
|----|-----------|
| US-01 | 管理者として、APIキーを設定するだけで、毎日自動でポッドキャストが生成・配信されるようにしたい |
| US-02 | 管理者として、ニュースソースを追加・変更して、収集するコンテンツのジャンルをカスタマイズしたい |
| US-03 | 管理者として、プロンプトでAI音声のスタイルや話し方を調整したい |
| US-04 | リスナーとして、ポッドキャストアプリで購読して毎日新しいエピソードを聴きたい |
| US-05 | 管理者として、手動でもポッドキャスト生成を実行できるようにしたい |
| US-06 | リスナーとして、短時間で全ニュースを把握できる速報版と、注目トピックを深く理解できる深掘り版の両方を選んで聴きたい |
| US-07 | 管理者として、海外のテクノロジーニュースも自動収集して、日本語ポッドキャストで紹介したい |

---

## 7. 制約事項

- TTS APIの利用には月額コストが発生する可能性がある（プランαなら$0）
- 生成される音声の長さはAPI毎のリクエスト上限に制約される
- LLMで生成するスクリプトの品質がポッドキャストの面白さを左右する
- 日本語のTTS品質はサービスにより差がある（要事前テスト）
- Spotify for Creators等のポッドキャスト配信サービスは、API経由の自動アップロードに制限がある場合がある
